
\documentclass[10pt, a4paper]{article}
\usepackage[utf8]{inputenc}
\usepackage[margin=1in]{geometry}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{array}

\begin{document}
\itshape


\begin{verbatim}
data Val = Num Int
         | Ch Char
         | Fail
         | Constr String Int [Val]
         | Ptr Addr

data Node = Def Int [Val] Code
          | Seq [Val]

data Instruction = Pushnum Int | Pushch Char
                 | Pushfail
                 | Pushglobal String
                 | Pushdef Int [(Int, Int)] Code
                 | Pusharg Int Int
                 | Slide Int Int
                 | Alloc Int
                 | Enter Int | Return
                 | Eval | Unwind
                 | Pack String Int Int
                 | Casejump [(Int, Code)]
                 | Casefail Code Code
                 | Error
                 | Add | Sqrt ...

type Code    = [Instruction]
type Stack   = [Addr]
type Heap    = H.Heap Node
type Globals = M.Map String H.Addr

Initial state: [Pushglobal "main", Eval] [a] h{a -> []}
Final states:  [] [a] h{a -> [v]} (v literal or Constructor)
               (Error:cs) as h
\end{verbatim}

~


\begin{center}



\begin{tabular}{|rrrl|} 

\hline


% Rule
& \verb|Pushnum| i:cs & a:as & h\{a $\rightarrow$ vs\} \\ 
$\implies$ & cs & a:as & h\{a $\rightarrow$ \verb|Num| i:vs\} \\ 
\hline

% Rule
& \verb|Pushch| c:cs & a:as & h\{a $\rightarrow$ vs\} \\ 
$\implies$ & cs & a:as & h\{a $\rightarrow$ \verb|Ch| c:vs\} \\ 
\hline

% Rule
& \verb|Pushfail|:cs & a:as & h\{a $\rightarrow$ vs\} \\ 
$\implies$ & cs & a:as & h\{a $\rightarrow$ \verb|Fail|:vs\} \\ 
\hline

% Rule
& \verb|Pushglobal| s:cs & a:as & h\{a $\rightarrow$ vs\} \\ 
$\implies$ & cs & a:as & h\{a $\rightarrow$ \verb|Ptr| $a'$:vs\} \\ 
& & & (globals s = $a'$) \\ 
\hline

% Rule
& \verb|Pushdef| k xs $cs'$:cs & as & h\{a $\rightarrow$ vs\} \\ 
$\implies$ & cs & as & h$\left\lbrace
                \begin{array}{@{}l@{}}a \rightarrow \verb|Ptr| \, a':vs \\
                              a' \rightarrow \verb|Def| \, k \, vs'' \, cs' \verb||
                \end{array}
              \right\rbrace$ \\
\multicolumn{4}{|c|}{($vs''$=[$vs'$(y) $|$ xs$\rightarrow$(x,y), as(x)$\rightarrow vs'$])} \\
\hline

% Rule
& \verb|Pusharg| n m:cs & $a_{0}:\ldots:a_{n}$:as &
            h$\left\lbrace
                \begin{array}{@{}l@{}}a_{0} \rightarrow vs \\
                                      a_{n} \rightarrow v_{0}:\ldots:v_{m}:vs'
                \end{array}
              \right\rbrace$ \\
$\implies$ & cs & $a_{0}:\ldots:a_{n}$:as & h\{$a_{0} \rightarrow v_{m}:vs$\} \\
\hline

% Rule
& \verb|Slide| n m:cs & a:as &
            h\{$a_{0} \rightarrow
                v_{1}:\ldots:v_{n}:v_{n+1}:\ldots:v_{n+m}:vs$\} \\
$\implies$ & cs & a:as & h\{$a_{0} \rightarrow v_{1}:\ldots:v_{n}:vs$\} \\
\hline

% Rule
& \verb|Alloc n|:cs & a:as & h\{a $\rightarrow$ vs\} \\ 
$\implies$ & cs & a:as & h$\left\lbrace
                \begin{array}{@{}l@{}}a \rightarrow \verb|Ptr| \, a_{1}: \ldots :\verb|Ptr| \, a_{n}:vs \\
                                   a_{1}, \ldots, a_{n} \rightarrow []
                \end{array}
              \right\rbrace$ \\ 
\hline


\end{tabular}






\begin{tabular}{|rrrl|} 

\hline

% Rule
& \verb|Enter| n:cs & a:as & h\{$a \rightarrow v_{0}:\ldots:v_{n}:vs, v_{n} = \verb|Ptr| \, a'$\} \\ 
$\implies$ & cs & $a'$:a:as & h \\
\hline

% Rule
& \verb|Return|:cs & a:as & h \\ 
$\implies$ & cs & as & h \\ 
\hline

% Rule
& \verb|Add|:cs & a:as & h\{$a \rightarrow \verb|Num| \, n_{1}:\verb|Num| \, n_{2}:vs$\} \\ 
$\implies$ & cs & a:as & h\{a $\rightarrow$ \verb|Num| $(n_{1}+n_{2})$:vs\} \\ 
\hline

% Rule
& \verb|Sqrt|:cs & a:as & h\{a $\rightarrow$ \verb|Num| n:vs\} \\ 
$\implies$ & cs & a:as & h\{$a \rightarrow \verb|Num| \, (sqrt \, n):vs$\} \\ 
\hline

% Rule
& \verb|Pack| s t n:cs & a:as & h\{$a \rightarrow v_{1}:\ldots:v_{n}:vs$\} \\
$\implies$ & cs & a:as & h\{$a \rightarrow \verb|Constr| \, s \, t \, [v_{1}, \ldots, v_{n}]$:vs\} \\
\hline

% Rule
& \verb|Casejump| $[\ldots, t \rightarrow cs', \ldots]$:cs & a:as & h\{a $\rightarrow$ \verb|Constr| s t $vs'$:vs\} \\
$\implies$ & $cs'$++cs & a:as & h\{a $\rightarrow vs'$++vs\} \\
\hline

% Rule
& \verb|Casefail| $cs' cs''$:cs & a:as & h\{a $\rightarrow$ \verb|Fail|:vs\} \\
$\implies$ & $cs'$++cs & a:as & h \\
\hline

% Rule
& \verb|Casefail| $cs' cs''$:cs & a:as & h\{a $\rightarrow$ v:vs\} \\
$\implies$ & $cs''$++cs & a:as & h \\
\multicolumn{4}{|c|}{(v $\ne$ Fail)} \\
\hline

% Rule
& \verb|Eval|:cs & a:as & h\{a $\rightarrow$ v:vs\} \\ 
$\implies$ & cs & a:as & h \\
\multicolumn{4}{|c|}{(v is literal or Constructor or Fail or v = Ptr $a'$, $a'$ $\rightarrow$ Def k * *, k$>$0)} \\
\hline

% Rule
& \verb|Eval|:cs & a:as &
            h$\left\lbrace
                \begin{array}{@{}l@{}}a \rightarrow \verb|Ptr| \, a':vs \\
                           a' \rightarrow \verb|Def| \, 0 \, vs' \, cs' \verb||
                \end{array}
              \right\rbrace$ \\
$\implies$ & $cs'$++ \verb|[Unwind]|++cs & $a'$:a:as & h\{$a'$ $\rightarrow vs'$\} \\
\hline

% Rule
& \verb|Eval|:cs & a:as & h$\left\lbrace
                \begin{array}{@{}l@{}}a \rightarrow \verb|Ptr| \, a':vs \\
                                      a' \nrightarrow \verb|Def| \, * \, * \, *
                \end{array}
              \right\rbrace$ \\ 
$\implies$ & \verb|Unwind|:cs & $a'$:a:as & h \\
\hline



% Rule
& \verb|Unwind|:cs & $a'$:a:as &
            h$\left\lbrace
                \begin{array}{@{}l@{}}a \rightarrow \verb|Ptr| \, a':vs \\
                                      a' \rightarrow [v]
                \end{array}
              \right\rbrace$ \\
$\implies$ & cs & a:as & h\{a $\rightarrow$ v:vs\} \\
\multicolumn{4}{|c|}{(v literal or Constructor or Fail)} \\
\hline

% Rule
& \verb|Unwind|:cs & a:as &
            h$\left\lbrace
                \begin{array}{@{}l@{}}a \rightarrow \verb|Ptr| \, a':vs \\
                           a' \rightarrow \verb|Def| \, 0 \, vs' \, cs' \verb||
                \end{array}
              \right\rbrace$ \\
$\implies$ & $cs'$++ \verb|[Unwind, Unwind]|++cs & $a'$:a:as & h\{$a'$ $\rightarrow vs'$\} \\
\hline


% Rule
& \verb|Unwind|:cs & a:as &
            h$\left\lbrace
                \begin{array}{@{}l@{}}a \rightarrow \verb|Ptr| \, a':vs \\
                           a' \rightarrow \verb|Def| \, k \, vs' \, cs' \verb||
                \end{array}
              \right\rbrace$ \\
$\implies$ & $cs'$++ \verb|[Unwind]|++cs & a:as & h\{a $\rightarrow vs'$++vs\} \\
\multicolumn{4}{|c|}{(0 $<$ k $\leq$ length vs)} \\
\hline



% Rule
& \verb|Unwind|:cs & $a'$:a:as &
            h$\left\lbrace
                \begin{array}{@{}l@{}}a \rightarrow \verb|Ptr| \, a':vs \\
                                      a' \rightarrow \verb|Ptr| \, a'':vs' \\
                               a'' \rightarrow \verb|Def| \, k \, * \, *\verb||
                \end{array}
              \right\rbrace$ \\
$\implies$ & cs & a:as & h\{a $\rightarrow$ \verb|Ptr| $a''$:($vs'$++vs)\} \\
\multicolumn{4}{|c|}{(k $>$ length $vs'$)} \\
\hline

% Rule
& \verb|Unwind|:cs & a:as &
            h$\left\lbrace
                \begin{array}{@{}l@{}}a \rightarrow \verb|Ptr| \, a':vs \\
                                      a' \nrightarrow \verb|Def| \, * \, * \, *
                \end{array}
              \right\rbrace$ \\
$\implies$ & \verb|Unwind:Unwind|:cs & $a'$:a:as & h \\
\hline




\end{tabular}



\end{center}



\end{document}

